# Backtesting

Backtesing framework written in C++17 to simulate trading strategy for BTC/USD pair.

#### DISCLAIMER âš ï¸ğŸ›‘

THIS FRAMEWORK IS NOT INTENDED FOR ANY REAL-WORLD INVESTMENT DECISIONS. THE USE OF THIS FRAMEWORK AND THE DATA PROVIDED IS AT YOUR OWN RISK. I DO NOT TAKE ANY RESPONSIBILITY FOR THE CORRECTNESS OF THE DATA OR ANY OUTPUTS GENERATED BY THIS FRAMEWORK WHEN APPLIED IN REAL-WORLD SCENARIOS. THIS FRAMEWORK IS DESIGNED SOLELY FOR LEARNING AND EDUCATIONAL PURPOSES.

- [Dependency](#dependency)
- [Project Structure](#project-structure)
- [Data Download](#data-download)
- [Compiling & Building](#compiling-building)
- [Tick Data Generation](#tick-data-generation)
- [Strategy Example And Other Terms](#strategy-and-terms)
- [How to Run](#run)
- [Optimization levels](#levels)
- [Eureka Found ğŸ¤¯](#eureka-ğŸ¤¯)
- [License](#license)

#### Dependency

[common-util](https://github.com/xpd54/common_util) added as git submodule.
[gnu plot](http://www.gnuplot.info/) On mac easy installation would be `brew install gnuplot`
C++17, CMake, LLVM

#### Project-Structure

```
â”œâ”€â”€ backtesting
â”‚Â Â  â”œâ”€â”€ base (This compiles as static lib which get used in both data generation and simulation)
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ account (Keep track of account balance/simulate buy and sell)
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ common_interface
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ price_history (OHLC data clean up)
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ trade_simulator (Interface to add new trade strategy)
â”‚Â Â  â”‚Â Â  â””â”€â”€ util (Read/Write into binary file, getting cmd line argument)
â”‚Â Â  â”œâ”€â”€ execution (actually running the simulation)
â”‚Â Â  â”œâ”€â”€ logs (log generation which get used to plot a graph)
â”‚Â Â  â””â”€â”€ simulators (Trading strategy and Trade Simulator logic)
â”‚Â Â      â””â”€â”€ strategy
â”œâ”€â”€ data (Create this folder to hold ohlc data)
â”œâ”€â”€ data_generator (Logic to convert TPV to OHLC and change frequency of OHLC)
â”œâ”€â”€ external (Added dependancy as git submodule, memory map file, logger, time, command line argument and string formate util)
â”œâ”€â”€ quick_run (bash script to quickly running the project)
â””â”€â”€ result_plot (logic to plot a graph after running simulation)
```

#### Data-Download

Time Price Volume (TPV) data is hosted on kaggle. It can be downloaded directly or with use of `wget` [link to download](https://www.kaggle.com/api/v1/datasets/download/saltwateroil/bitstamp-tpv-usd).

create a folder name `data` and unzip data there with name `bitstamp_tick_data.csv`
![hardware](/screenshots/data-download.png)

#### Compiling-Building

1. clone the repo `git clone https://github.com/xpd54/backtesting`
2. update submodule `git submodule update --init --recursive`
3. create a build folder and build `mkdir build && cd build && cmake .. && make`

This generate 3 exicutables

1. ohlc_generator (To convert TPV to binary form of OHLC data formate)
2. trade_simulator (Execute trade simulation)
3. plot (plot graph with evaluation log)

#### Tick-Data-Generation

Any trade simulation we would like to run on different frequency of tick data. `ohlc_generator` does this to do it quickly with **[start_time - end_time)** (time range to consider for ohlc (open high low close))

`cd quick_run && chmod +x quick_ohlc_generation.sh`
`./quick_ohlc_generation.sh` (might take a minute or two as tpv data is close to 3.2gb). I suggest checking `quick_ohlc_generation.sh` before running it, naming convention is self explanatory.

#### Strategy-and-Terms

Rebalancing Trade Strategy :- Basic idea here is to keep the protfolio value (BTC \* BTC price + USD) in a way where crypto currency weight is defined by **alpha** and it's allowed to go up and down by **epsilon**.
Example :-
**alpha** 0.7 means that we would like to keep 70% of the total portfolio value in the base (crypto) currency,
and 30% in the quote currency (USD) for whole execution time. So Current quick run between
**[start_time="2017-01-01" - end_time="2024-01-01"]**
we would mentain 70% in BTC and 30% in USD for whole 7 years while looking to make profit.

**epsilon** 0.05f means maximum allowed deviation from the desired alpha-allocation.
We allow the actual base (crypto) currency allocation to be within the interval: **[alpha x (1 - epsilon) - alpha x (1 + epsilon)]**.

So [0.735 - 0.665] which means it's allowed to allocate 73.5% to 66.5% in BTC and rest corresponding in USD.
<small>codebase is self explanatory but will add more clarity in words soon!!</small>
